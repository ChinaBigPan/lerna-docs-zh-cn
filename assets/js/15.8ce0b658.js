(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{359:function(s,a,t){"use strict";t.r(a);var e=t(43),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"排忧解难"}},[s._v("排忧解难")]),s._v(" "),t("p",[s._v("这个文档包含了我们的用户在过去使用 Lerna 时遇到的一些问题的解决方案。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/lerna/lerna/blob/master/doc/troubleshooting.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("英文原地址"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"boostrap-指令"}},[s._v("Boostrap 指令")]),s._v(" "),t("h3",{attrs:{id:"使用-yarn-的时候客户端出错了"}},[s._v("使用 yarn 的时候客户端出错了")]),s._v(" "),t("p",[s._v("在 Lerna "),t("code",[s._v("v2.0.0-rc")]),s._v("发布之前，使用"),t("code",[s._v("--npm-client")]),s._v("参数可能因为引导过程不能正常运行而受到影响。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Error running command.\nerror Command failed with "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" code "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("请将 Lerna 升级到上述版本，或者添加"),t("code",[s._v("--concurrency=1")]),s._v("作为替代方案。")]),s._v(" "),t("h3",{attrs:{id:"私有的-npm-注册-artifactory、npm-enterprise等等-集成问题"}},[s._v("私有的 npm 注册 (Artifactory、npm Enterprise等等)集成问题")]),s._v(" "),t("p",[s._v("如果"),t("code",[s._v("lerna bootstrap")]),s._v("失败，那是因为您在私有服务器上本身有了库，所以请确保包含该注册表。示例:"),t("code",[s._v("lerna bootstrap -- --registry=http://[registry-url]")])]),s._v(" "),t("h2",{attrs:{id:"import-指令"}},[s._v("Import 指令")]),s._v(" "),t("h3",{attrs:{id:"引入期间的缓冲-buffer-问题"}},[s._v("引入期间的缓冲(buffer)问题")]),s._v(" "),t("p",[s._v("当你尝试导入一个存储库且它的提交(commit)非常多时，你有可能会得到一个错误，比如:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("DeprecationWarning: Unhandled promise rejections are deprecated\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("或")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Error: spawnSync /bin/sh ENOBUFS during ImportCommand.execute\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("解决办法：")])]),s._v(" "),t("p",[s._v("运行"),t("code",[s._v("lerna import")]),s._v("时加上"),t("code",[s._v("--max-buffer")]),s._v("并传入足够大的数字(按字节算)。底层默认值是"),t("code",[s._v("10MB")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"无法导入合并冲突提交"}},[s._v("无法导入合并冲突提交")]),s._v(" "),t("p",[s._v("当您尝试导入一个包含合并提交(需要解决冲突)的存储库时，import命令会失败并出现一个错误:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("lerna ERR"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" execute Error: Command failed: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" am -3\nlerna ERR"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" execute error: Failed to merge "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the changes.\nlerna ERR"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" execute CONFLICT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": Merge conflict "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("解决办法：")])]),s._v(" "),t("p",[s._v("运行"),t("code",[s._v("lerna import")]),s._v("时加上"),t("code",[s._v("--flatten")]),s._v("进入“flat”模式以引入历史。也就是说，每一次合并提交都是一个引入合并的单独变更。")]),s._v(" "),t("h2",{attrs:{id:"当-git-树有未提交的更改时失败"}},[s._v("当 git 树有未提交的更改时失败")]),s._v(" "),t("p",[s._v("若当前的项目收到"),t("strong",[s._v("未提交的更改")]),s._v("，您会收到"),t("code",[s._v("fatal: ambiguous argument 'HEAD':")]),s._v("错误。")]),s._v(" "),t("p",[t("strong",[s._v("解决办法：")])]),s._v(" "),t("p",[s._v("在使用"),t("code",[s._v("lerna import")]),s._v("任何包之前，请确保提交 lerna 项目中的更改。")]),s._v(" "),t("h2",{attrs:{id:"publish-指令"}},[s._v("Publish 指令")]),s._v(" "),t("h3",{attrs:{id:"在-github-github-enterprise-模式下，publish不会检测手动创建的标签。"}},[s._v("在 Github/Github Enterprise 模式下，"),t("code",[s._v("Publish")]),s._v("不会检测手动创建的标签。")]),s._v(" "),t("p",[s._v("当通过"),t("a",{attrs:{href:"https://help.github.com/articles/working-with-tags",target:"_blank",rel:"noopener noreferrer"}},[s._v("web ui"),t("OutboundLink")],1),s._v("创建发布时，Github 和 Github Enterprise 使用轻量级的 Git 标签，而 Lerna 使用注释标签。")]),s._v(" "),t("p",[s._v("这可能会造成一个问题，Lerna 会忽略之前已经手动执行并使用 Github web ui 标记过的发布版本。")]),s._v(" "),t("p",[s._v("例如，如果发布的历史如下：")]),s._v(" "),t("ul",[t("li",[s._v("v1.1.0 通过"),t("code",[s._v("lerna publish")]),s._v("发布并标记。")]),s._v(" "),t("li",[s._v("v1.2.0 通过 Github web ui 手动发布并标记。")]),s._v(" "),t("li",[s._v("v1.2.1 通过 Github web ui 手动发布并标记。")])]),s._v(" "),t("p",[s._v("那么运行"),t("code",[s._v("lerna publish")]),s._v("现在会侦测 v1.1.0 而非 v1.2.1 作为最新的发布标记。")]),s._v(" "),t("p",[s._v("这其中的含义取决于您对"),t("code",[s._v("lerna publish")]),s._v("的使用方式：")]),s._v(" "),t("ul",[t("li",[s._v("发布提示符将使用 v1.1.0 作为主要/次要/补丁(major/minor/patch)建议的基础。")]),s._v(" "),t("li",[s._v("当使用"),t("code",[s._v("--conventional-commit")]),s._v("时：\n"),t("ul",[t("li",[s._v("建议基于自 v1.1.0 以来的所有提交(包括来自 v1.2.0、v1.2.1 等的提交)来增加语义化版本号。")]),s._v(" "),t("li",[s._v("生成的 CHANGELOG.md 文件将重复所有已经在 v1.2.0、v1.2.1 等版本中发布的提交。")])])])]),s._v(" "),t("p",[t("strong",[s._v("解决办法：")])]),s._v(" "),t("p",[s._v("尽可能使用"),t("code",[s._v("lerna publish")]),s._v("而非手动发布。")]),s._v(" "),t("p",[s._v("对于新的手动版本，使用"),t("code",[s._v("git tag -a -m <version>")]),s._v("，而非 Github web ui。")]),s._v(" "),t("p",[s._v("对于现有的轻量级标签，它们可以通过以下方式转换为注释标签:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GIT_AUTHOR_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" show $1 --format"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%aN -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GIT_AUTHOR_EMAIL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" show $1 --format"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%aE -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GIT_AUTHOR_DATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" show $1 --format"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%aD -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GIT_COMMITTER_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" show $1 --format"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%cN -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GIT_COMMITTER_EMAIL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" show $1 --format"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%cE -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GIT_COMMITTER_DATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" show $1 --format"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%cD -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" tag -a -m "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" -f "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push --tags --force\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("参见"),t("a",{attrs:{href:"https://stackoverflow.com/questions/5002555/can-a-lightweight-tag-be-converted-to-an-annotated-tag",target:"_blank",rel:"noopener noreferrer"}},[s._v("这个帖子"),t("OutboundLink")],1),s._v("获取更多信息。")]),s._v(" "),t("h2",{attrs:{id:"发布到私有的-npm-注册表-artifactory-npm-enterprise-等等"}},[s._v("发布到私有的 npm 注册表 (Artifactory, npm Enterprise 等等)")]),s._v(" "),t("p",[s._v("如果"),t("code",[s._v("lerna publish")]),s._v("失败，请确保您的"),t("code",[s._v("package.json")]),s._v("中有：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"publishConfig"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://[registry-url]"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("您可能还需要在您的"),t("code",[s._v(".npmrc")]),s._v("文件中添加以下内容:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("egistry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" https://"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("registry-url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);