(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{364:function(s,e,a){"use strict";a.r(e);var t=a(43),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"lerna-bootstrap"}},[s._v("@lerna/bootstrap")]),s._v(" "),a("blockquote",[a("p",[s._v("将本地包链接在一起并安装剩余的包依赖项")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/lerna/lerna/tree/master/commands/publish#readme",target:"_blank",rel:"noopener noreferrer"}},[s._v("英文原地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("安装 lerna 以访问"),a("code",[s._v("lerna")]),s._v(" CLI。")]),s._v(" "),a("h2",{attrs:{id:"使用"}},[s._v("使用")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("引导当前 Lerna 仓库中的包。安装器所有·依赖项并连接所有的交叉依赖。")]),s._v(" "),a("p",[s._v("在运行时，该命令：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("npm install")]),s._v("每个包所有的外部依赖。")]),s._v(" "),a("li",[s._v("将所有相互依赖的 Lerna "),a("code",[s._v("package")]),s._v("符号链接在一起。")]),s._v(" "),a("li",[s._v("在所有引导包中运行"),a("code",[s._v("npm run prepublish")]),s._v("(除非传入了"),a("code",[s._v("--ignore-prepublish")]),s._v(")。")]),s._v(" "),a("li",[s._v("在所有引导包中运行"),a("code",[s._v("npm run prepare")]),s._v("。")])]),s._v(" "),a("p",[a("code",[s._v("lerna bootstrap")]),s._v("接受所有"),a("a",{attrs:{href:"https://www.npmjs.com/package/@lerna/filter-options",target:"_blank",rel:"noopener noreferrer"}},[s._v("过滤器属性"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("通过将额外的参数放在"),a("code",[s._v("--")]),s._v("之后来传递给 npm 客户端：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap -- --production --no-optional\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在"),a("code",[s._v("lerna.json")]),s._v("中这样配置：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"npmClient"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yarn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"npmClientArgs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--production"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--no-optional"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"hoist-glob"}},[s._v("--hoist [glob]")]),s._v(" "),a("p",[s._v("在仓库根目录安装与"),a("code",[s._v("glob")]),s._v("匹配的外部依赖，这样所有包都可以使用他们。这些依赖的任何二进制文件都将链接到依赖包的"),a("code",[s._v("node_modules/.bin/")]),s._v("目录中，这样 npm 脚本就可以使用它们了。如果传了该参数但却没有设置"),a("code",[s._v("glob")]),s._v("，则默认为"),a("code",[s._v("**")]),s._v("(提升所有)。该配置项仅影响"),a("code",[s._v("bootstrap")]),s._v("命令。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap --hoist\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("关于"),a("code",[s._v("--hoist")]),s._v("，请参阅文档"),a("a",{attrs:{href:"https://github.com/lerna/lerna/blob/master/doc/hoist.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("hoist documentation"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("如果包依赖于不同版本的外部依赖项，则会将最常用的版本提升，并发出警告。")])]),s._v(" "),a("p",[a("code",[s._v("--hoist")]),s._v("与"),a("code",[s._v("file：")]),s._v("标识符"),a("a",{attrs:{href:"https://github.com/lerna/lerna/issues/1679#issuecomment-461544321",target:"_blank",rel:"noopener noreferrer"}},[s._v("不兼容"),a("OutboundLink")],1),s._v("，请只使用一个。")]),s._v(" "),a("h3",{attrs:{id:"strict"}},[s._v("--strict")]),s._v(" "),a("p",[s._v("当和"),a("code",[s._v("hoist")]),s._v("一起使用时，会抛出一个错误，并在发出版本警告后停止引导。如果没有"),a("code",[s._v("hoist")]),s._v("或没有版本警告则无效果。")]),s._v(" "),a("h3",{attrs:{id:"nohoist-glob"}},[s._v("--nohoist [glob]")]),s._v(" "),a("p",[a("strong",[s._v("不要")]),s._v("在仓库根目录安装与"),a("code",[s._v("glob")]),s._v("匹配的外部依赖项。该参数可以用来选择不提升某些依赖项。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap --hoist --nohoist"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("babel-*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"ignore"}},[s._v("--ignore")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap --ignore component-*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("该参数与"),a("code",[s._v("bootstrap")]),s._v("命令一起使用时，也可以在"),a("code",[s._v("lerna.json")]),s._v("的"),a("code",[s._v("command.bootstrap.ignore")]),s._v("中设置。命令行中设置该参数优先于"),a("code",[s._v("lerna.json")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"command"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"bootstrap"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ignore"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"component-*"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("通配符匹配的是"),a("code",[s._v("package.json")]),s._v("中定义的包名，而不是与包所在的目录名。")])]),s._v(" "),a("h2",{attrs:{id:"配置项"}},[s._v("配置项")]),s._v(" "),a("h3",{attrs:{id:"ignore-prepublish"}},[a("code",[s._v("--ignore-prepublish")])]),s._v(" "),a("p",[s._v("跳过在引导包中默认运行的预发布生命周期脚本。注意，这个生命周期是"),a("a",{attrs:{href:"https://docs.npmjs.com/misc/scripts#deprecation-note",target:"_blank",rel:"noopener noreferrer"}},[s._v("已废弃的"),a("OutboundLink")],1),s._v("，可能会在Lerna 的下一个主要版本中被删除。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap --ignore-prepublish\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"ignore-scripts"}},[a("code",[s._v("--ignore-scripts")])]),s._v(" "),a("p",[s._v("跳过在引导包中正常运行的生命周期脚本("),a("code",[s._v("prepare")]),s._v("等等)。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap --ignore-scripts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"registry-url"}},[a("code",[s._v("--registry <url>")])]),s._v(" "),a("p",[s._v("当使用该参数时，转发的 npm 命令将为您的包使用指定的注册表。")]),s._v(" "),a("p",[s._v("如果您不想在使用私有注册表时在所有 package.json 文件中分别设置注册表配置，那么这就是它出场的时候了。")]),s._v(" "),a("h3",{attrs:{id:"npm-client-client"}},[a("code",[s._v("--npm-client <client>")])]),s._v(" "),a("p",[s._v("它必须是一个知道如何安装 npm 包依赖的可执行文件。默认的"),a("code",[s._v("--npm-client")]),s._v("是"),a("code",[s._v("npm")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap --npm-client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yarn\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("也可在"),a("code",[s._v("lerna.json")]),s._v("中配置：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"npmClient"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yarn"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"use-workspaces"}},[a("code",[s._v("--use-workspaces")])]),s._v(" "),a("p",[s._v("支持和 "),a("a",{attrs:{href:"https://github.com/yarnpkg/rfcs/blob/master/implemented/0000-workspaces-install-phase-1.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("yarn 工作区"),a("OutboundLink")],1),s._v(" (从yarn@0.27+版本开始)数组中的值是 Lerna 将在其中委托操作给 Yarn 的命令(目前仅在 bootstrap 中可用)。如果"),a("code",[s._v("--use-workspaces")]),s._v("为真，那么"),a("code",[s._v("packages")]),s._v("将被"),a("code",[s._v("package.json/workspaces")]),s._v("的值覆盖。")]),s._v(" "),a("p",[s._v("也可在"),a("code",[s._v("lerna.json")]),s._v("中配置：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"npmClient"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yarn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"useWorkspaces"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("根级别的 package.json 还必须包含一个工作区数组:")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"devDependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lerna"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^2.2.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"workspaces"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"packages/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("这个列表与 lerna 的 "),a("code",[s._v("package")]),s._v("配置大体上类似(通过 package.json 用通配符匹配的目录列表)，只是它不支持递归的通配符匹配("),a("code",[s._v("**")]),s._v("，也叫“globstars”)")]),s._v(" "),a("h3",{attrs:{id:"no-ci"}},[a("code",[s._v("--no-ci")])]),s._v(" "),a("p",[s._v("当使用默认的"),a("code",[s._v("--npm-client")]),s._v("，"),a("code",[s._v("lerna bootstrap")]),s._v("将调用"),a("a",{attrs:{href:"https://docs.npmjs.com/cli/ci",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm ci"),a("OutboundLink")],1),s._v("而非在 CI 环境中调用"),a("code",[s._v("npm install")]),s._v("。若要禁用此行为，可以使用"),a("code",[s._v("--no-ci")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap --no-ci\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("若要在本地安装期间强制执行(在本地安装中不会自动启用)，请使用"),a("code",[s._v("--ci")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap --ci\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这对于“干净的”重新安装或重新克隆后的初次安装非常有用。")]),s._v(" "),a("h3",{attrs:{id:"force-local"}},[a("code",[s._v("--force-local")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lerna bootstrap --force-local\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("当使用该参数时，它会让"),a("code",[s._v("bootstrap")]),s._v("命令始终符号链接本地依赖项，而不考虑匹配的版本范围。")]),s._v(" "),a("h3",{attrs:{id:"publishconfig-directory"}},[a("code",[s._v("publishConfig.directory")])]),s._v(" "),a("p",[s._v("这个"),a("em",[s._v("非标准")]),s._v("字段允许您自定义符号链接子目录，它会作为符号链接的源目录，就像使用已发布的包一样。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"publishConfig"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"directory"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("在本例中，当这个包被引导并链接时，"),a("code",[s._v("dist")]),s._v("目录将是源目录(例如"),a("code",[s._v("package-1/dist => node_modules/package-1")]),s._v(")。")]),s._v(" "),a("h2",{attrs:{id:"它是怎么工作的？"}},[s._v("它是怎么工作的？")]),s._v(" "),a("p",[s._v("让我们以"),a("code",[s._v("babel")]),s._v("为例：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("babel-generator")]),s._v("和"),a("code",[s._v("source-map")]),s._v("(以及其他)是"),a("code",[s._v("babel-core")]),s._v("的依赖项。")]),s._v(" "),a("li",[a("code",[s._v("babel-core")]),s._v("的"),a("a",{attrs:{href:"https://github.com/babel/babel/blob/13c961d29d76ccd38b1fc61333a874072e9a8d6a/packages/babel-core/package.json#L28-L47",target:"_blank",rel:"noopener noreferrer"}},[s._v("package.json"),a("OutboundLink")],1),s._v("将这两个包作为"),a("code",[s._v("dependencies")]),s._v("中列出，如下所示。")])]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// babel-core package.json")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"babel-core"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"babel-generator"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^6.9.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"source-map"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^0.5.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[s._v("Lerna 会检查每个依赖项是否也是 Lerna 仓库的一部分。\n"),a("ul",[a("li",[s._v("在本例中，"),a("code",[s._v("babel-generator")]),s._v("可以是内部依赖项，而"),a("code",[s._v("source-map")]),s._v("始终是外部依赖项。")]),s._v(" "),a("li",[a("code",[s._v("babel-core")]),s._v("的"),a("code",[s._v("package.json")]),s._v("中的"),a("code",[s._v("babel-generator")]),s._v("版本通过"),a("code",[s._v("packages/babel-generator")]),s._v("来对应，传递内部依赖项。")]),s._v(" "),a("li",[a("code",[s._v("source-map")]),s._v("和正常一样使用"),a("code",[s._v("npm install")]),s._v("(或"),a("code",[s._v("yarn")]),s._v(")安装。")])])]),s._v(" "),a("li",[a("code",[s._v("packages/babel-core/node_modules/babel-generator")]),s._v("符号链接到"),a("code",[s._v("packages/babel-generator")])]),s._v(" "),a("li",[s._v("允许目录嵌套引入。")])]),s._v(" "),a("h2",{attrs:{id:"注意"}},[s._v("注意")]),s._v(" "),a("ul",[a("li",[s._v("当仓库中相同名称的包不能满足包中的依赖版本时，它将像往常一样以"),a("code",[s._v("npm install")]),s._v("或"),a("code",[s._v("yarn")]),s._v("的方式安装。")]),s._v(" "),a("li",[s._v("类似"),a("code",[s._v("latest")]),s._v("的 Dist-tag，并不满足"),a("a",{attrs:{href:"https://semver.npmjs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("语义化版本"),a("OutboundLink")],1),s._v("范围。")]),s._v(" "),a("li",[s._v("循环依赖会导致循环符号链接，这可能会影响编辑器/IDE。")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.jetbrains.com/webstorm/",target:"_blank",rel:"noopener noreferrer"}},[s._v("WebStorm"),a("OutboundLink")],1),s._v("会在出现循环符号链接时锁定。为了防止这种情况，在"),a("code",[s._v("首选项(Preferences) => 编辑器(Editor) => 文件类型(File Types) => 忽略文件和文件夹(Ignored files and folders)")]),s._v("列表中添加"),a("code",[s._v("node_modules")]),s._v("。")])])}),[],!1,null,null,null);e.default=n.exports}}]);