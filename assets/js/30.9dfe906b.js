(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{374:function(s,a,n){"use strict";n.r(a);var e=n(43),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"lerna-run"}},[n("code",[s._v("@lerna/run")])]),s._v(" "),n("blockquote",[n("p",[s._v("在包含该脚本中的每个包中运行 npm 脚本")])]),s._v(" "),n("p",[s._v("安装 lerna 以访问"),n("code",[s._v("lerna")]),s._v(" CLI。")]),s._v(" "),n("h2",{attrs:{id:"使用"}},[s._v("使用")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("lerna run "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -- "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在所有包含 my-script 的包中运行 npm run")]),s._v("\nlerna run "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\nlerna run build\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 观察所有包和 transpile 的变化，使用流前缀输出")]),s._v("\nlerna run --parallel "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("在包含该脚本中的每个包中运行"),n("a",{attrs:{href:"https://docs.npmjs.com/misc/scripts",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm 脚本"),n("OutboundLink")],1),s._v("，必须使用双横线"),n("code",[s._v("--")]),s._v("来将虚线参数传递给给执行的脚本。")]),s._v(" "),n("h2",{attrs:{id:"配置项"}},[s._v("配置项")]),s._v(" "),n("p",[n("code",[s._v("lerna exec")]),s._v("接受所有的"),n("a",{attrs:{href:"https://www.npmjs.com/package/@lerna/filter-options",target:"_blank",rel:"noopener noreferrer"}},[s._v("过滤器参数"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("lerna run --scope my-component "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"npm-client-client"}},[n("code",[s._v("--npm-client <client>")])]),s._v(" "),n("p",[s._v("必须是一个知道如何运行 npm 生命周期脚本的可执行文件。默认的"),n("code",[s._v("--npm-client")]),s._v("是"),n("code",[s._v("npm")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("lerna run build --npm-client"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yarn\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("也可以在"),n("code",[s._v("lerna.json")]),s._v("中配置：")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"command"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"run"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"npmClient"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yarn"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"stream"}},[n("code",[s._v("--stream")])]),s._v(" "),n("p",[s._v("立即从子进程输出流，它的前缀为原始的包名。这让不同的包交叉输出成为可能。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("lerna run "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" --stream\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"parallel"}},[n("code",[s._v("--parallel")])]),s._v(" "),n("p",[s._v("和"),n("code",[s._v("--stream")]),s._v("相类似，但完全忽略并发性和拓扑顺序。它会立即在带有前缀的流输出的所有匹配包中运行给定的命令或脚本。这是在许多包上运行的长时间运行的进程(如"),n("code",[s._v("npm run watch")]),s._v(")的首选参数。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("lerna run "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" --parallel\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),n("p",[s._v("在使用"),n("code",[s._v("--parallel")]),s._v("时建议限制该命令的作用域，因为生成几十个子进程可能会损害 shell 的稳定性(例如，最大文件描述符限制)。这个因人而异。")])]),s._v(" "),n("h3",{attrs:{id:"no-bail"}},[n("code",[s._v("--no-bail")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在所有包含它的包中运行 npm 脚本，忽略非零(错误)退出代码")]),s._v("\nlerna run --no-bail "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("默认情况下，如果任何执行过程返回一个非零的退出代码，"),n("code",[s._v("lerna run")]),s._v("将退出并报错。"),n("code",[s._v("——no-bail")]),s._v("可以禁用此行为，让其所有包中执行，而无视退出代码。")]),s._v(" "),n("h3",{attrs:{id:"no-prefix"}},[n("code",[s._v("--no-prefix")])]),s._v(" "),n("p",[s._v("当输出为流("),n("code",[s._v("--stream")]),s._v("或"),n("code",[s._v("--parallel")]),s._v(")时禁用包名前缀。该配置项应用在将结果传输到其他进程时很有用，比如编辑器插件。")]),s._v(" "),n("h3",{attrs:{id:"profile"}},[n("code",[s._v("--profile")])]),s._v(" "),n("p",[s._v("对命令执行进行分析，并生成性能分析文件，可以在基于 chrome 的浏览器中使用 DevTools 进行分析(URL为：devtools://devtools/bundled/devtools_app.html)。该分析文件显示了命令执行的时间线，其中每次执行都会分配给一个打开的槽。槽的数量由"),n("code",[s._v("--concurrency")]),s._v("决定，开放槽的数量由"),n("code",[s._v("--concurrency")]),s._v("减去正在进行的操作的数量决定。最终结果是对并行执行命令的可视化展示。")]),s._v(" "),n("p",[s._v("性能分析文件输出的默认位置是项目的根目录。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("lerna run build --profile\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),n("p",[s._v("Lerna 只会在启用拓扑排序(即不使用"),n("code",[s._v("--parallel")]),s._v("和"),n("code",[s._v("--no-sort")]),s._v(")时分析性能。")])]),s._v(" "),n("h3",{attrs:{id:"profile-location-location"}},[n("code",[s._v("--profile-location <location>")])]),s._v(" "),n("p",[s._v("您可以提供一个自定义位置用于性能分析文件的输出。提供的路径是相对于当前工作目录进行解析的。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("lerna run build --profile --profile-location"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("logs/profile/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);