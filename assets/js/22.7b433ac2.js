(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{368:function(a,s,e){"use strict";e.r(s);var t=e(43),n=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"lerna-exec"}},[e("code",[a._v("@lerna/exec")])]),a._v(" "),e("blockquote",[e("p",[a._v("在每个包中执行任意命令")])]),a._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/lerna/lerna/tree/master/commands/exec#readme",target:"_blank",rel:"noopener noreferrer"}},[a._v("英文原地址"),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("安装 lerna 以访问"),e("code",[a._v("lerna")]),a._v(" CLI。")]),a._v(" "),e("h2",{attrs:{id:"使用"}},[a._v("使用")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -- "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("command"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("args"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 在所有包中运行命令")]),a._v("\nlerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" -rf ./node_modules\nlerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -- protractor conf.js\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("在每个包中执行任意命令。必须使用双横线"),e("code",[a._v("--")]),a._v("来将虚线参数传递给派生的命令，但当所有参数都是位置时，就不是必需的了。")]),a._v(" "),e("p",[a._v("当前包的名称可以通过环境变量"),e("code",[a._v("LERNA_PACKAGE_NAME")]),a._v("获取：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" view "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$LERNA_PACKAGE_NAME")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("您也可以通过环境变量"),e("code",[a._v("LERNA_ROOT_PATH")]),a._v("在一个复杂的目录结构中运行一个位于根目录下的脚本：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -- node "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$LERNA_ROOT_PATH")]),a._v("/scripts/some-script.js\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"配置项"}},[a._v("配置项")]),a._v(" "),e("p",[e("code",[a._v("lerna exec")]),a._v("接受所有的"),e("a",{attrs:{href:"https://www.npmjs.com/package/@lerna/filter-options",target:"_blank",rel:"noopener noreferrer"}},[a._v("过滤器参数"),e("OutboundLink")],1)]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" --scope my-component -- "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" -la\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("blockquote",[e("p",[a._v("使用给定的并发(除了"),e("code",[a._v("--parallel")]),a._v(")并行生成命令。输出是以管道形式传输的，所以并不确定。如果您想一个接一个包运行这个命令，可以这样使用：")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" --concurrency "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" -la\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h3",{attrs:{id:"stream"}},[e("code",[a._v("--stream")])]),a._v(" "),e("p",[a._v("立即从子进程输出流，它的前缀为原始的包名。这让不同的包交叉输出成为可能。")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" --stream -- babel src -d lib\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h3",{attrs:{id:"parallel"}},[e("code",[a._v("--parallel")])]),a._v(" "),e("p",[a._v("和"),e("code",[a._v("--stream")]),a._v("相类似，但完全忽略并发性和拓扑顺序。它会立即在带有前缀的流输出的所有匹配包中运行给定的命令或脚本。这是在许多包上运行的长时间运行的进程(如"),e("code",[a._v("babel src -d lib -w")]),a._v(")的首选参数。")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" --parallel -- babel src -d lib -w\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),e("p",[a._v("在使用"),e("code",[a._v("--parallel")]),a._v("时建议限制该命令的作用域，因为生成几十个子进程可能会损害 shell 的稳定性(例如，最大文件描述符限制)。这个因人而异。")])]),a._v(" "),e("h3",{attrs:{id:"no-bail"}},[e("code",[a._v("--no-bail")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 运行一个命令，忽略非零(错误)退出代码")]),a._v("\nlerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" --no-bail "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("command"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("默认情况下，如果任何执行过程返回一个非零的退出代码，"),e("code",[a._v("lerna exec")]),a._v("将退出并报错。"),e("code",[a._v("——no-bail")]),a._v("可以禁用此行为，让其所有包中执行，而无视退出代码。")]),a._v(" "),e("h3",{attrs:{id:"no-prefix"}},[e("code",[a._v("--no-prefix")])]),a._v(" "),e("p",[a._v("当输出为流("),e("code",[a._v("--stream")]),a._v("或"),e("code",[a._v("--parallel")]),a._v(")时禁用包名前缀。该配置项应用在将结果传输到其他进程时很有用，比如编辑器插件。")]),a._v(" "),e("h3",{attrs:{id:"profile"}},[e("code",[a._v("--profile")])]),a._v(" "),e("p",[a._v("对命令执行进行分析，并生成性能分析文件，可以在基于 chrome 的浏览器中使用 DevTools 进行分析(URL为：devtools://devtools/bundled/devtools_app.html)。该分析文件显示了命令执行的时间线，其中每次执行都会分配给一个打开的槽。槽的数量由"),e("code",[a._v("--concurrency")]),a._v("决定，开放槽的数量由"),e("code",[a._v("--concurrency")]),a._v("减去正在进行的操作的数量决定。最终结果是对并行执行命令的可视化展示。")]),a._v(" "),e("p",[a._v("性能分析文件输出的默认位置是项目的根目录。")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" --profile -- "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("command"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),e("p",[a._v("Lerna 只会在启用拓扑排序(即不使用"),e("code",[a._v("--parallel")]),a._v("和"),e("code",[a._v("--no-sort")]),a._v(")时分析性能。")])]),a._v(" "),e("h3",{attrs:{id:"profile-location-location"}},[e("code",[a._v("--profile-location <location>")])]),a._v(" "),e("p",[a._v("您可以提供一个自定义位置用于性能分析文件的输出。提供的路径是相对于当前工作目录进行解析的。")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" --profile --profile-location"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("logs/profile/ -- "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("command"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);