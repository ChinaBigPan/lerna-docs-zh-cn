(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{354:function(s,t,a){"use strict";a.r(t);var n=a(43),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"常见问题"}},[s._v("常见问题")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/lerna/lerna/blob/master/FAQ.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("英文原地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("该文档原作者仍旧保持更新，如果英文内容有新增，请通知。")]),s._v(" "),a("h2",{attrs:{id:"如何将包添加到-lerna-库"}},[s._v("如何将包添加到 Lerna 库?")]),s._v(" "),a("p",[s._v("对于添加到 Lerna 存储库中的任何包，您应该运行"),a("code",[s._v("[lerna bootstrap](https://github.com/lerna/lerna/blob/master/commands/bootstrap/README.md)")]),s._v("，而不是运行npm安装。这将考虑到包文件夹中的现有项目以及外部依赖关系。")]),s._v(" "),a("h3",{attrs:{id:"新包"}},[s._v("新包")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("packages")]),s._v("文件夹中为您的包创建一个目录，并正常运行"),a("code",[s._v("npm init")]),s._v("来创建"),a("code",[s._v("package.json")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"现有包"}},[s._v("现有包")]),s._v(" "),a("p",[s._v("您可以使用"),a("code",[s._v("[lerna import <package>][lerna import <package>]")]),s._v("将现有的包转移到 Lerna 存储库中；此命令将保存提交历史记录。")]),s._v(" "),a("p",[a("code",[s._v("[lerna import <package>][lerna import <package>]")]),s._v("采用本地路径而不是 URL。在这种情况下，您需要在文件系统中有连接到仓库。")]),s._v(" "),a("h2",{attrs:{id:"如果publish失败了，我如何重试呢？"}},[s._v("如果"),a("code",[s._v("publish")]),s._v("失败了，我如何重试呢？")]),s._v(" "),a("p",[s._v("有些时候"),a("code",[s._v("lerna publish")]),s._v("不起作用。可能是您的网络出现了波动，也可能是没有登录到 npm 等等。")]),s._v(" "),a("p",[s._v("如果"),a("code",[s._v("lerna.json")]),s._v("并没有更新，重试一下"),a("code",[s._v("lerna publish")]),s._v("。")]),s._v(" "),a("p",[s._v("如果已经更新，您可以强制重新发布。"),a("code",[s._v("lerna publish --force-publish $(ls packages/)")])]),s._v(" "),a("h2",{attrs:{id:"bootstrap-过程慢到爆，咋办啊？"}},[s._v("bootstrap 过程慢到爆，咋办啊？")]),s._v(" "),a("p",[s._v("包含许多包的项目可能需要很长时间才能启动。")]),s._v(" "),a("p",[s._v("如果您开启 hoisting 那么就可以显著地降低"),a("code",[s._v("lerna bootstrap")]),s._v("花费的时间，更多信息请参阅"),a("a",{attrs:{href:"https://github.com/lerna/lerna/blob/master/doc/hoist.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("hoisting 文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("p",[s._v("与此相结合，您可以通过使用"),a("code",[s._v("yarn")]),s._v("而不是"),a("code",[s._v("npm")]),s._v("客户端来提高"),a("code",[s._v("bootstrap")]),s._v("的性能。")]),s._v(" "),a("h2",{attrs:{id:"根目录package-json"}},[s._v("根目录"),a("code",[s._v("package.json")])]),s._v(" "),a("p",[s._v("根目录的"),a("code",[s._v("package.json")]),s._v("至少是您在 CI 构建期间本地安装"),a("code",[s._v("lerna")]),s._v("的方式。您还应该将您的测试、语法检查和类似的任务放在那里，从根目录运行它们，因为单独从每个包运行它们会比较慢。根目录还可以保存所有“hoisted”的包，这在使用"),a("code",[s._v("——hoist")]),s._v("时加速了 bootstrap。")]),s._v(" "),a("h2",{attrs:{id:"ci-设置"}},[s._v("CI 设置")]),s._v(" "),a("p",[s._v("正如上面所提到的根目录的"),a("code",[s._v("package.json")]),s._v("负责本地安装"),a("code",[s._v("lerna")]),s._v("。不过您需要自动运行"),a("code",[s._v("bootstrap")]),s._v("。这可以通过将其作为 npm 脚本在 CI 阶段使用来实现。")]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-monorepo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"devDependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"eslint"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^3.19.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"jest"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^20.0.4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lerna"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^2.0.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"bootstrap"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lerna bootstrap --hoist"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pretest"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eslint packages"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jest"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("以 CircleCI 配置文件为例 ("),a("code",[s._v("circle.yml")]),s._v("):")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run bootstrap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);