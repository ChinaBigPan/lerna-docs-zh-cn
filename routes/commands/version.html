<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lerna/version | Lerna</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/lerna-docs-zh-cn/images/lerna_favicon.ico">
    <meta name="description" content="用于管理带有多个包的 JavaScript 项目的工具。">
    <link rel="preload" href="/lerna-docs-zh-cn/assets/css/0.styles.6207e96a.css" as="style"><link rel="preload" href="/lerna-docs-zh-cn/assets/js/app.49e1ae94.js" as="script"><link rel="preload" href="/lerna-docs-zh-cn/assets/js/2.c7b6054d.js" as="script"><link rel="preload" href="/lerna-docs-zh-cn/assets/js/31.d82404dc.js" as="script"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/10.b75cc033.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/11.779ba1c2.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/12.00a61c83.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/13.7471e1ef.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/14.d4e8f0b4.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/15.8ce0b658.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/16.54beaf8c.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/17.9563e499.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/18.b02194ea.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/19.9bf827cd.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/20.d00780e6.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/21.0aca7fe9.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/22.7b433ac2.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/23.0304035d.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/24.1b83ab75.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/25.a92ecad3.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/26.cf0eee03.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/27.373f414c.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/28.356c1ef7.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/29.b6e9c1cc.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/3.46363123.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/30.9dfe906b.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/4.7351e2e0.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/5.392966c7.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/6.3569bd4e.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/7.01317e14.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/8.e54138c8.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/9.70d8ce96.js">
    <link rel="stylesheet" href="/lerna-docs-zh-cn/assets/css/0.styles.6207e96a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lerna-docs-zh-cn/" class="home-link router-link-active"><img src="/lerna-docs-zh-cn/images/logo.png" alt="Lerna" class="logo"> <span class="site-name can-hide">Lerna</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.febeacon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大笑文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/" class="nav-link">
  文档首页
</a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/routes/commands/" class="nav-link router-link-active">
  Lerna 指令
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.febeacon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大笑文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/" class="nav-link">
  文档首页
</a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/routes/commands/" class="nav-link router-link-active">
  Lerna 指令
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lerna-docs-zh-cn/routes/commands/" class="sidebar-link">指令总览</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/publish.html" class="sidebar-link">lerna/publish</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/version.html" class="active sidebar-link">lerna/version</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#位置" class="sidebar-link">位置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#语义化版本号" class="sidebar-link">语义化版本号</a></li></ul></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#预发布" class="sidebar-link">预发布</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#配置项" class="sidebar-link">配置项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#allow-branch-glob" class="sidebar-link">--allow-branch &lt;glob&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#amend" class="sidebar-link">--amend</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#changelog-preset" class="sidebar-link">--changelog-preset</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#conventional-commits" class="sidebar-link">--conventional-commits</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#conventional-graduate" class="sidebar-link">--conventional-graduate</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#conventional-prerelease" class="sidebar-link">--conventional-prerelease</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#create-release-type" class="sidebar-link">--create-release &lt;type&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#exact" class="sidebar-link">--exact</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#force-publish" class="sidebar-link">--force-publish</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#git-remote-name" class="sidebar-link">--git-remote &lt;name&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#ignore-changes" class="sidebar-link">--ignore-changes</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#ignore-scripts" class="sidebar-link">--ignore-scripts</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#include-merged-tags" class="sidebar-link">--include-merged-tags</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#message-msg" class="sidebar-link">--message &lt;msg&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#no-changelog" class="sidebar-link">--no-changelog</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#no-commit-hooks" class="sidebar-link">--no-commit-hooks</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#no-git-tag-version" class="sidebar-link">--no-git-tag-version</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#no-granular-pathspec" class="sidebar-link">--no-granular-pathspec</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#no-private" class="sidebar-link">--no-private</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#no-push" class="sidebar-link">--no-push</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#preid" class="sidebar-link">--preid</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#sign-git-commit" class="sidebar-link">--sign-git-commit</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#sign-git-tag" class="sidebar-link">--sign-git-tag</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#force-git-tag" class="sidebar-link">--force-git-tag</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#tag-version-prefix" class="sidebar-link">--tag-version-prefix</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#yes" class="sidebar-link">--yes</a></li></ul></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#已废弃配置项" class="sidebar-link">已废弃配置项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#cd-version" class="sidebar-link">--cd-version</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#repo-version" class="sidebar-link">--repo-version</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#skip-git" class="sidebar-link">--skip-git</a></li></ul></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#提示" class="sidebar-link">提示</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#生成初始的更新日志" class="sidebar-link">生成初始的更新日志</a></li></ul></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/version.html#生命周期" class="sidebar-link">生命周期</a></li></ul></li><li><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html" class="sidebar-link">lerna/bootstrap</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/list.html" class="sidebar-link">lerna/list</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/changed.html" class="sidebar-link">lerna/changed</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/diff.html" class="sidebar-link">lerna/diff</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/exec.html" class="sidebar-link">lerna/exec</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/run.html" class="sidebar-link">lerna/run</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/init.html" class="sidebar-link">lerna/init</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/add.html" class="sidebar-link">lerna/add</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/clean.html" class="sidebar-link">lerna/clean</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/import.html" class="sidebar-link">lerna/import</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/link.html" class="sidebar-link">lerna/link</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/create.html" class="sidebar-link">lerna/create</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/info.html" class="sidebar-link">lerna/info</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="lerna-version"><code>@lerna/version</code></h1> <p><a href="https://github.com/lerna/lerna/tree/master/commands/version#lernaversion" target="_blank" rel="noopener noreferrer">英文原地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>更改自上次发布以来的包版本号。</p></blockquote> <h2 id="使用">使用</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version <span class="token number">1.0</span>.1 <span class="token comment"># 显式指定</span>
lerna version patch <span class="token comment"># 语义化关键字</span>
lerna version       <span class="token comment"># 根据提示选择</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在运行时，该命令执行以下操作:</p> <ol><li>标识自上一个版本以来更新的包。</li> <li>提示输入新版本。</li> <li>修改包的元数据，在根目录和每个包当中运行适当的生命周期脚本。</li> <li>提交这些更改并打上标记。</li> <li>推动到 git 远程服务器。</li></ol> <h2 id="位置">位置</h2> <h3 id="语义化版本号">语义化版本号</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version <span class="token punctuation">[</span>major <span class="token operator">|</span> minor <span class="token operator">|</span> patch <span class="token operator">|</span> premajor <span class="token operator">|</span> preminor <span class="token operator">|</span> prepatch <span class="token operator">|</span> prerelease<span class="token punctuation">]</span>
<span class="token comment"># 使用下一个语义化版本号，然后跳过“为…选择一个新版本”的提示。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当传递位置参数时，<code>lerna version</code>将跳过版本选择的提示问题并根据关键字<a href="https://github.com/npm/node-semver#functions" target="_blank" rel="noopener noreferrer">增加<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>版本号。当然仍然需要使用<code>--yes</code>来避免所有的问题。</p> <h2 id="预发布">预发布</h2> <p>如果你有一个预发布版本号的软件包(例如<code>2.0.0-beta.3</code>)，并且你运行了<code>lerna version</code>和一个非预先发布的版本(<code>major</code>、<code>minor</code>或<code>patch</code>)，它将会发布那些之前发布的软件包以及自上次发布以来已经改变的软件包。</p> <p>对于使用常规提交的项目，使用以下标志进行预发行管理：</p> <ul><li><a href="https://github.com/lerna/lerna/tree/master/commands/version#--conventional-prerelease" target="_blank" rel="noopener noreferrer">--conventional-prerelease<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: 将当前更改作为预发行版本发布。</li> <li><a href="https://github.com/lerna/lerna/tree/master/commands/version#--conventional-graduate" target="_blank" rel="noopener noreferrer">--conventional-graduate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: 将预发布版本的包升级为稳定版本。</li></ul> <p>如果不使用上面的参数运行<code>lerna version --conventional-commits</code>，则只有在版本已经在<code>prerelease</code>中时，才会将当前更改作为<code>prerelease</code>释放。</p> <h2 id="配置项">配置项</h2> <h3 id="allow-branch-glob"><code>--allow-branch &lt;glob&gt;</code></h3> <p>匹配启用了<code>lerna version</code>的 git 分支的白名单。在<code>lerna.json</code>中配置它是最简单的(我们也这么推荐)，但是也可以将它作为 CLI 配置项传入进去。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;allowBranch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;master&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>使用上面的配置，<code>lerna version</code>在除<code>master</code>之外的任何分支运行时都将失败。最佳实践是将<code>lerna version</code>限制到主分支。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;allowBranch&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;master&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;feature/*&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在上面的配置中，<code>lerna version</code>将被允许出现在任何以<code>feature/</code>为前缀的分支中。请注意，在 feature 分支中生成 git 标签会产生潜在的错误，因为这些分支会被合并到主分支中。如果标签和其原始上下文“分离”开来(可能通过<code>squash merge</code>或<code>conflicted merge</code>提交)，那么未来的<code>lerna version</code>执行将很难确定正确的“自上一个版本以来的差异”。</p> <p>使用命令行会覆盖这个“持久”的配置，请谨慎使用。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --allow-branch hotfix/oops-fix-the-thing
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="amend"><code>--amend</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --amend
<span class="token comment"># 保留 commit 的消息，并跳过 git push</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当使用该参数运行时，<code>lerna version</code>将对当前提交执行所有更改，而不是添加一个新的。这在<a href="https://en.wikipedia.org/wiki/Continuous_integration" target="_blank" rel="noopener noreferrer">持续集成(CI)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>期间非常有用，可以减少项目历史记录中的提交数量。</p> <p>为了防止意外的覆盖，这个命令将跳过<code>git push</code>(也就是说<code>--no-push</code>)。</p> <h3 id="changelog-preset"><code>--changelog-preset</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --conventional-commits --changelog-preset angular-bitbucket
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>默认情况下，changelog 预设值是<a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-angular#angular-convention" target="_blank" rel="noopener noreferrer">angular<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。在某些情况下，您可能需要使用另一个预设值或自定义一个。</p> <p>预设值是常规更改日志的内置或可安装配置的名称。预设值可以作为包的全名或自动扩展的后缀进行传递(举个例子，<code>angular</code>扩展为<code>conventional-changelog-angular</code>)。</p> <h3 id="conventional-commits"><code>--conventional-commits</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --conventional-commits
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当您使用这个参数运行时，<code>lerna version</code>将使用<a href="https://conventionalcommits.org/" target="_blank" rel="noopener noreferrer">传统的提交规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来<a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-recommended-bump" target="_blank" rel="noopener noreferrer">确定版本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>并<a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-cli" target="_blank" rel="noopener noreferrer">生成 CHANGELOG.md 文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>传入<a href="https://github.com/lerna/lerna/tree/master/commands/version#--no-changelog" target="_blank" rel="noopener noreferrer">--no-changelog<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>将阻止生成(或更新)<code>CHANGELOG.md</code>文件。</p> <h3 id="conventional-graduate"><code>--conventional-graduate</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --conventional-commits --conventional-graduate<span class="token operator">=</span>package-2,package-4

<span class="token comment"># 强制分隔所有的预发行包</span>
lerna version --conventional-commits --conventional-graduate
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当使用该参数时，<code>lerna version</code>将使用<code>*</code>分隔指定的包(用逗号隔开的)或所有的包。无论当前的 HEAD 是否已释放，该命令都可以工作，它和<code>--force-publish</code>相类似，除了忽略任何非预发布包。如果未指定的包(如果指定了包)或未预先发布的包发生了更改，那么这些包将按照它们通常使用的<code>--conventional-commits</code>提交的方式进行版本控制。</p> <p>“分隔”一个软件包意味着一个预发布版本的非预发布版本变体。例如<code>package-1@1.0.0-alpha.0 =&gt; package-1@1.0.0</code>。</p> <blockquote><p>注意：当指定包时，它的依赖项将被释放，但不会被分隔。</p></blockquote> <h3 id="conventional-prerelease"><code>--conventional-prerelease</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --conventional-commits --conventional-prerelease<span class="token operator">=</span>package-2,package-4

<span class="token comment"># 强制所有发生改变的包变为预发布</span>
lerna version --conventional-commits --conventional-prerelease
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当使用该参数时，<code>lerna version</code>将使用<code>*</code>分隔指定的包(用逗号隔开的)或所有的包。通过在<code>conventional-commits</code>的版本推荐之前加上<code>pre</code>，可以将所有未发布的更改作为 pre (patch/minor/major/release)版来发布。如果当前的更改包含了特性提交，那么推荐的版本将成为<code>minor</code>，因此该参数会使其成为<code>preminor</code>发布。如果未指定的包(如果指定了包)或未预先发布的包发生了更改，那么这些包将按照它们通常使用的<code>--conventional-commits</code>提交的方式进行版本控制。</p> <h3 id="create-release-type"><code>--create-release &lt;type&gt;</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --conventional-commits --create-release github
lerna version --conventional-commits --create-release gitlab
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当使用该参数时，<code>lerna version</code>将基于更改的包创建一个正式的 GitHub 或 GitLab 版本。需要传递<code>conventional-commits</code>以便生成变更日志。</p> <p>要使用 GitHub 进行身份验证，可以定义以下环境变量。</p> <ul><li><code>GH_TOKEN</code>（必须）- 您的 GitHub 认证 token (在设置(Settings) &gt; 开发人员设置(Developer Settings) &gt; 个人访问令牌(Personal access tokens)下)。</li> <li><code>GHE_API_URL</code> - 当使用 GitHub Enterprise 时，API 的绝对URL。</li> <li><code>GHE_VERSION</code> - 当使用 GitHub Enterprise 时，当前安装的 GHE 版本。<a href="https://github.com/octokit/plugin-enterprise-rest.js" target="_blank" rel="noopener noreferrer">支持以下版本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <p>要使用 GitLab 进行身份验证，可以定义以下环境变量。</p> <ul><li><code>GL_TOKEN</code>（必须）- 您的 GitLab 认证 token (在用户设置(User Settings) &gt; 访问令牌(Access Tokens)下)。</li> <li><code>GL_API_URL</code> - API 的绝对URL，包括版本号。(默认值：https://gitlab.com/api/v4)</li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>当使用该配置项的时候，不要设置<code>--no-changelog</code></p></div> <p>该配置项也可以在<code>lerna.json</code>中配置：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;changelogPreset&quot;</span><span class="token operator">:</span> <span class="token string">&quot;angular&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果预先导出一个构件函数（如：<code>conventional-changelog-conventionalcommits</code>），您也可以指定<a href="https://github.com/conventional-changelog/conventional-changelog-config-spec" target="_blank" rel="noopener noreferrer">预设配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;changelogPreset&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;conventionalcommits&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;issueUrlFormat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{{host}}/{{owner}}/{{repository}}/issues/{{id}}&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="exact"><code>--exact</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --exact
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当使用该参数时，<code>lerna version</code>将在更新的包中精确地指定更新过的依赖项(无标点符号)，而不做语义化版本号兼容(使用<code>^</code>)。</p> <p>有关更多信息，请参见 package.json 文档的<a href="https://docs.npmjs.com/files/package.json#dependencies" target="_blank" rel="noopener noreferrer">依赖关系<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="force-publish"><code>--force-publish</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --force-publish<span class="token operator">=</span>package-2,package-4

<span class="token comment"># 强制所有的包标上版本</span>
lerna version --force-publish
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当使用该参数时，<code>lerna version</code>将强制发布指定的包(逗号分隔)或使用<code>*</code>发布所有包。</p> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>这将跳过以更改包的<code>lerna changed</code>检查，并强制更新没有<code>git diff</code>更改的包。</p></div> <h3 id="git-remote-name"><code>--git-remote &lt;name&gt;</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --git-remote upstream
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当使用该参数时，<code>lerna version</code>将把 git 更改推送到指定的远程服务器，而不是<code>origin</code>。</p> <h3 id="ignore-changes"><code>--ignore-changes</code></h3> <p>当检测到更改的包时，忽略由通配符匹配到的文件中的更改。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --ignore-changes <span class="token string">'**/*.md'</span> <span class="token string">'**/__tests__/**'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>该配置项最好通过<code>lerna.json</code>指定，既避免过早的 shell 验证也能够和<code>lerna diff</code>及<code>lerna changed</code>共享配置：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;ignoreChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/__fixtures__/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;**/__tests__/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;**/*.md&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用<code>--no-ignore-changes</code>禁用任何现有的持久配置。</p> <div class="custom-block warning"><p class="custom-block-title">在下列情况下，无论该配置项如何设置，包都会发布：</p> <ol><li>该包的最新版本是<code>prerelease</code>版(即<code>1.0.0-alpha</code>，<code>1.0.0-0.3.7</code>等等)。</li> <li>包的一个或多个相关依赖项已发生更改。</li></ol></div> <h3 id="ignore-scripts"><code>--ignore-scripts</code></h3> <p>当使用该参数时，<code>lerna version</code>会在运行期间禁用<a href="https://github.com/lerna/lerna/tree/master/commands/version#lifecycle-scripts" target="_blank" rel="noopener noreferrer">生命周期脚本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="include-merged-tags"><code>--include-merged-tags</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --include-merged-tags
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在检测更改的包时包含合并分支的标记。</p> <h3 id="message-msg"><code>--message &lt;msg&gt;</code></h3> <p>可简写为<code>-m</code>，用于<code>git commit</code>。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version -m <span class="token string">&quot;chore(release): publish %s&quot;</span>
<span class="token comment"># commit message = &quot;chore(release): publish v1.0.0&quot;</span>

lerna version -m <span class="token string">&quot;chore(release): publish %v&quot;</span>
<span class="token comment"># commit message = &quot;chore(release): publish 1.0.0&quot;</span>

<span class="token comment"># 当单独对包进行版本控制时，不会替换占位符</span>
lerna version -m <span class="token string">&quot;chore(release): publish&quot;</span>
<span class="token comment"># commit message = &quot;chore(release): publish</span>
<span class="token comment">#</span>
<span class="token comment"># - package-1@3.0.1</span>
<span class="token comment"># - package-2@1.5.4&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>当使用该参数时，<code>lerna version</code>会在提交发布版本更新时使用所提供的消息。对于将 lerna 集成到期望提交消息遵守某些规则的项目中非常有用，例如使用<a href="https://github.com/commitizen/cz-cli" target="_blank" rel="noopener noreferrer">commitizen<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和/或<a href="https://github.com/semantic-release/semantic-release" target="_blank" rel="noopener noreferrer">语义化版本发布<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的项目。</p> <p>如果消息包含<code>%s</code>，则将其替换为新的全局版本版本号，该版本号前缀为“v”。如果消息包含<code>%v</code>，它将被替换为新的全局版本版本号，但没有前缀“v”。注意，这个占位符插值只在使用默认的“固定”版本模式时使用，因为在独立版本控制时没有“全局”版本可以进行插值。</p> <p>在<code>lerna.json</code>中这样配置：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chore(release): publish %s&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="no-changelog"><code>--no-changelog</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --conventional-commits --no-changelog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用<code>--conventional-commits</code>时，不要生成任何<code>CHANGELOG.md</code>文件。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>当使用该配置项的时候，不要设置<code>--create-release</code></p></div> <h3 id="no-commit-hooks"><code>--no-commit-hooks</code></h3> <p>默认情况下，<code>lerna version</code>将允许 git commit 钩子在提交版本更改时运行。通过<code>——no-commit-hook</code>来禁用此行为。</p> <p>该配置项类似于<code>npm version</code>的<a href="https://docs.npmjs.com/misc/config#commit-hooks" target="_blank" rel="noopener noreferrer">--commit-hooks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>配置项，只是反过来了。</p> <h3 id="no-git-tag-version"><code>--no-git-tag-version</code></h3> <p>默认情况下，<code>lerna version</code>将提交对 package.json 文件的更改，并标记发行版。通过<code>——no-git-tag-version</code>可以禁用该行为。</p> <p>该配置项与<code>npm version</code>的配置项<a href="https://docs.npmjs.com/misc/config#git-tag-version" target="_blank" rel="noopener noreferrer">--git-tag-version<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>相类似，只是反过来了。</p> <h3 id="no-granular-pathspec"><code>--no-granular-pathspec</code></h3> <p>默认情况下，<code>lerna version</code>将在<code>git add</code>时只添加在版本控制过程中更改过的叶子包 manifest (可能还有更改日志)。这相当于<code>git add -- packages/*/package.json</code>，但是精确地定制了变化。</p> <p>如果您<strong>确定</strong>需要不同的行为，您就会理解：通过<code>——no-granular-pathspec</code>来使 git 命令执行<code>git add -- .</code>。通过设置<a href="https://git-scm.com/docs/gitglossary#Documentation/gitglossary.txt-aiddefpathspecapathspec" target="_blank" rel="noopener noreferrer">pathspec<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<strong>您必须将所有秘密和构建输出适当地忽略掉，否则它们会被提交并推到仓库的。</strong></p> <p>通过<code>lerna.json</code>设置：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;independent&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;granularPathspec&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>采用根级配置是有意为之，因为它还包括了<code>lerna publish</code>中的<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--no-granular-pathspec" target="_blank" rel="noopener noreferrer">同名配置项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="no-private"><code>--no-private</code></h3> <p>默认情况下，<code>lerna version</code>将在选择版本、提交和标记发布时包含私有包。我们可以通过<code>--no-private</code>来禁用该行为。</p> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>该配置项并未将<a href="https://docs.npmjs.com/about-private-packages" target="_blank" rel="noopener noreferrer">私有作用域的包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>排除在外，只会排除 package.json 文件中<code>private</code><a href="https://docs.npmjs.com/configuring-npm/package-json.html#private" target="_blank" rel="noopener noreferrer">字段<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>设置为<code>true</code>的包。</p></div> <h3 id="no-push"><code>--no-push</code></h3> <p>默认情况下，<code>lerna version</code>将提交和标记的更改推到已配置的 <a href="https://github.com/lerna/lerna/tree/master/commands/version#--git-remote-name" target="_blank" rel="noopener noreferrer">git 远程服务器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。设置<code>--no-push</code>来禁用此行为。</p> <h3 id="preid"><code>--preid</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version prerelease
<span class="token comment"># 使用下一个语义化预发布版本，如：</span>
<span class="token comment"># 1.0.0 =&gt; 1.0.1-alpha.0</span>

lerna version prepatch --preid next
<span class="token comment"># 通过制定的预发布标识符以使用下一个语义化预发布版本，如</span>
<span class="token comment"># 1.0.0 =&gt; 1.0.1-next.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>使用该参数时，<code>lerna version</code>将使用<a href="http://semver.org/#spec-item-9" target="_blank" rel="noopener noreferrer">指定的 prerelease 标识符<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>递增<code>premajor</code>、<code>preminor</code>、<code>prepatch</code>或<code>prerelease</code> 语义化版本号。</p> <h3 id="sign-git-commit"><code>--sign-git-commit</code></h3> <p>该配置项和<code>npm version</code>的同名<a href="https://docs.npmjs.com/misc/config#sign-git-commit" target="_blank" rel="noopener noreferrer">配置项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>相类似。</p> <h3 id="sign-git-tag"><code>--sign-git-tag</code></h3> <p>该配置项和<code>npm version</code>的同名<a href="https://docs.npmjs.com/misc/config#sign-git-tag" target="_blank" rel="noopener noreferrer">配置项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>相类似。</p> <h3 id="force-git-tag"><code>--force-git-tag</code></h3> <p>该配置项将替换任意的现有标签，而非失败信息。</p> <h3 id="tag-version-prefix"><code>--tag-version-prefix</code></h3> <p>该配置项允许设置自定义前缀，默认的前缀是:<code>v</code>。</p> <div class="custom-block tip"><p class="custom-block-title">请记住</p> <p>目前您必须设置两次：分别对应<code>version</code>命令和<code>publish</code>命令。</p></div> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 本地</span>
lerna version --tag-version-prefix<span class="token operator">=</span><span class="token string">''</span>
<span class="token comment"># 在 CI 上</span>
lerna publish from-git --tag-version-prefix<span class="token operator">=</span><span class="token string">''</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="yes"><code>--yes</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna version --yes
<span class="token comment"># 跳过 `Are you sure you want to publish these packages?`</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当使用该参数运行时，<code>lerna version</code>将将跳过所有确认提示。在<a href="https://en.wikipedia.org/wiki/Continuous_integration" target="_blank" rel="noopener noreferrer">持续集成(CI)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中用于自动回答发布确认提示。</p> <h2 id="已废弃配置项">已废弃配置项</h2> <blockquote><p>既然是已废弃的，内容就不翻译了。</p></blockquote> <h3 id="cd-version"><code>--cd-version</code></h3> <h3 id="repo-version"><code>--repo-version</code></h3> <h3 id="skip-git"><code>--skip-git</code></h3> <h2 id="提示">提示</h2> <h3 id="生成初始的更新日志">生成初始的更新日志</h3> <p>如果您在 monorepo 启动一段时间后才开始使用<code>--conventional-commits</code>配置项，您仍然可以使用<a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-cli#readme" target="_blank" rel="noopener noreferrer">conventional-changelog-cli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/lerna/lerna/tree/master/commands/exec#readme" target="_blank" rel="noopener noreferrer">lerna exec<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>为以前的版本生成更改日志。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># Lerna does not actually use conventional-changelog-cli, so you need to install it temporarily</span>
<span class="token function">npm</span> i -D conventional-changelog-cli
<span class="token comment"># Documentation: `npx conventional-changelog --help`</span>

<span class="token comment"># fixed versioning (default)</span>
<span class="token comment"># run in root, then leaves</span>
npx conventional-changelog --preset angular --release-count <span class="token number">0</span> --outfile ./CHANGELOG.md --verbose
npx lerna <span class="token builtin class-name">exec</span> --concurrency <span class="token number">1</span> --stream -- <span class="token string">'conventional-changelog --preset angular --release-count 0 --commit-path <span class="token environment constant">$PWD</span> --pkg <span class="token environment constant">$PWD</span>/package.json --outfile <span class="token environment constant">$PWD</span>/CHANGELOG.md --verbose'</span>

<span class="token comment"># independent versioning</span>
<span class="token comment"># (no root changelog)</span>
npx lerna <span class="token builtin class-name">exec</span> --concurrency <span class="token number">1</span> --stream -- <span class="token string">'conventional-changelog --preset angular --release-count 0 --commit-path <span class="token environment constant">$PWD</span> --pkg <span class="token environment constant">$PWD</span>/package.json --outfile <span class="token environment constant">$PWD</span>/CHANGELOG.md --verbose --lerna-package <span class="token variable">$LERNA_PACKAGE_NAME</span>'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>如果您使用<code>--changelog-preset</code>进行自定义，那么您应该相应地更改上面的示例中的<code>--preset</code>值。</p> <h2 id="生命周期">生命周期</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// preversion:  在设置版本号之前运行.</span>
<span class="token comment">// version:     在设置版本号之后，提交之前运行.</span>
<span class="token comment">// postversion: 在设置版本号之后，提交之后运行.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>lerna 将在<code>lerna version</code>期间运行<a href="https://docs.npmjs.com/misc/scripts#description" target="_blank" rel="noopener noreferrer">npm 生命周期脚本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p> <ol><li>侦测更改的包，选择版本号进行覆盖。</li> <li>在根目录运行<code>preversion</code>。</li> <li>对于每个更改的包，按照拓扑顺序(所有依赖项在依赖关系之前):<br>
i. 运行<code>preversion</code>生命周期。<br>
ii. 更新 package.json 中的版本。<br>
iii. 运行<code>version</code>生命周期。</li> <li>在根目录运行<code>version</code>生命周期。</li> <li>如果<a href="https://github.com/lerna/lerna/tree/master/commands/version#--no-git-tag-version" target="_blank" rel="noopener noreferrer">可用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，将更改文件添加到索引。</li> <li>如果<a href="https://github.com/lerna/lerna/tree/master/commands/version#--no-git-tag-version" target="_blank" rel="noopener noreferrer">可用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>创建提交和标记。</li> <li>对于每个改变包，按照词法顺序(根据目录结构的字母顺序):<br>
i. 运行<code>postversion</code>生命周期。</li> <li>在根目录运行<code>postversion</code>。</li> <li>如果<a href="https://github.com/lerna/lerna/tree/master/commands/version#--no-push" target="_blank" rel="noopener noreferrer">可用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>推动提交和标记到远程服务器。</li> <li>如果<a href="https://github.com/lerna/lerna/tree/master/commands/version#--create-release-type" target="_blank" rel="noopener noreferrer">可用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>创建发布。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lerna-docs-zh-cn/routes/commands/publish.html" class="prev">
        lerna/publish
      </a></span> <span class="next"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html">
        lerna/bootstrap
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lerna-docs-zh-cn/assets/js/app.49e1ae94.js" defer></script><script src="/lerna-docs-zh-cn/assets/js/2.c7b6054d.js" defer></script><script src="/lerna-docs-zh-cn/assets/js/31.d82404dc.js" defer></script>
  </body>
</html>
