<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lerna/publish | Lerna</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/lerna-docs-zh-cn/images/lerna_favicon.ico">
    <meta name="description" content="用于管理带有多个包的 JavaScript 项目的工具。">
    <link rel="preload" href="/lerna-docs-zh-cn/assets/css/0.styles.6207e96a.css" as="style"><link rel="preload" href="/lerna-docs-zh-cn/assets/js/app.49e1ae94.js" as="script"><link rel="preload" href="/lerna-docs-zh-cn/assets/js/2.c7b6054d.js" as="script"><link rel="preload" href="/lerna-docs-zh-cn/assets/js/29.b6e9c1cc.js" as="script"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/10.b75cc033.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/11.779ba1c2.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/12.00a61c83.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/13.7471e1ef.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/14.d4e8f0b4.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/15.8ce0b658.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/16.54beaf8c.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/17.9563e499.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/18.b02194ea.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/19.9bf827cd.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/20.d00780e6.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/21.0aca7fe9.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/22.7b433ac2.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/23.0304035d.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/24.1b83ab75.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/25.a92ecad3.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/26.cf0eee03.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/27.373f414c.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/28.356c1ef7.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/3.46363123.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/30.9dfe906b.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/31.d82404dc.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/4.7351e2e0.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/5.392966c7.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/6.3569bd4e.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/7.01317e14.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/8.e54138c8.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/9.70d8ce96.js">
    <link rel="stylesheet" href="/lerna-docs-zh-cn/assets/css/0.styles.6207e96a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lerna-docs-zh-cn/" class="home-link router-link-active"><img src="/lerna-docs-zh-cn/images/logo.png" alt="Lerna" class="logo"> <span class="site-name can-hide">Lerna</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.febeacon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大笑文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/" class="nav-link">
  文档首页
</a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/routes/commands/" class="nav-link router-link-active">
  Lerna 指令
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.febeacon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大笑文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/" class="nav-link">
  文档首页
</a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/routes/commands/" class="nav-link router-link-active">
  Lerna 指令
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lerna-docs-zh-cn/routes/commands/" class="sidebar-link">指令总览</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/publish.html" class="active sidebar-link">lerna/publish</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#位置" class="sidebar-link">位置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#from-git" class="sidebar-link">from-git</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#from-package" class="sidebar-link">from-package</a></li></ul></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#配置项" class="sidebar-link">配置项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#canary" class="sidebar-link">--canary</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#contents-dir" class="sidebar-link">--contents &lt;dir&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#dist-tag-tag" class="sidebar-link">--dist-tag &lt;tag&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#git-head-sha" class="sidebar-link">--git-head &lt;sha&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#graph-type-all-dependencies" class="sidebar-link">--graph-type &lt;all|dependencies&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#ignore-scripts" class="sidebar-link">--ignore-scripts</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#ignore-prepublish" class="sidebar-link">--ignore-prepublish</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#legacy-auth" class="sidebar-link">--legacy-auth</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#no-git-reset" class="sidebar-link">--no-git-reset</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#no-granular-pathspec" class="sidebar-link">--no-granular-pathspec</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#no-verify-access" class="sidebar-link">--no-verify-access</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#otp" class="sidebar-link">--otp</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#preid" class="sidebar-link">--preid</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#pre-dist-tag-tag" class="sidebar-link">--pre-dist-tag &lt;tag&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#registry-url" class="sidebar-link">--registry &lt;url&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#tag-version-prefix" class="sidebar-link">--tag-version-prefix</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#temp-tag" class="sidebar-link">--temp-tag</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#yes" class="sidebar-link">--yes</a></li></ul></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#已废弃的配置项" class="sidebar-link">已废弃的配置项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#skip-npm" class="sidebar-link">--skip-npm</a></li></ul></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#每个包的配置" class="sidebar-link">每个包的配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#publishconfig-access" class="sidebar-link">publishConfig.access</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#publishconfig-registry" class="sidebar-link">publishConfig.registry</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#publishconfig-tag" class="sidebar-link">publishConfig.tag</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#publishconfig-directory" class="sidebar-link">publishConfig.directory</a></li></ul></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/publish.html#生命周期脚本" class="sidebar-link">生命周期脚本</a></li></ul></li><li><a href="/lerna-docs-zh-cn/routes/commands/version.html" class="sidebar-link">lerna/version</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html" class="sidebar-link">lerna/bootstrap</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/list.html" class="sidebar-link">lerna/list</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/changed.html" class="sidebar-link">lerna/changed</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/diff.html" class="sidebar-link">lerna/diff</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/exec.html" class="sidebar-link">lerna/exec</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/run.html" class="sidebar-link">lerna/run</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/init.html" class="sidebar-link">lerna/init</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/add.html" class="sidebar-link">lerna/add</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/clean.html" class="sidebar-link">lerna/clean</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/import.html" class="sidebar-link">lerna/import</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/link.html" class="sidebar-link">lerna/link</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/create.html" class="sidebar-link">lerna/create</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/info.html" class="sidebar-link">lerna/info</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="lerna-publish"><code>@lerna/publish</code></h1> <blockquote><p>在当前项目中发布包</p></blockquote> <h2 id="使用">使用</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>lerna publish              <span class="token comment"># 发布自上一个版本以来发生了变化的包</span>
lerna publish from-git     <span class="token comment"># 发布当前提交中标记的包</span>
lerna publish from-package <span class="token comment"># 发布注册表中没有最新版本的包</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在运行时，该命令做了下面几件事中的一个：</p> <ul><li>发布自上一个版本以来更新的包(背后调用了<a href="https://github.com/lerna/lerna/tree/master/commands/version#readme" target="_blank" rel="noopener noreferrer">lerna version<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)。
<ul><li>这是 lerna 2.x 版本遗留下来的。</li></ul></li> <li>发布在当前提交中标记的包(<code>from-git</code>)。</li> <li>发布在最新提交时注册表中没有版本的包(<code>from-package</code>)。</li> <li>发布在前一次提交中更新的包(及其依赖项)的“金丝雀(canary)”版。</li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>Lerna 永远不会发布标记为<code>private</code>的包（<code>package.json</code>中的<code>”private“: true</code>）</p></div> <p>在所有的发布过程中，都有<a href="https://github.com/lerna/lerna/tree/master/commands/publish#lifecycle-scripts" target="_blank" rel="noopener noreferrer">生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在根目录和每个包中运行(除非使用了<code>--ignore-scripts</code>)。</p> <p>请查看<a href="https://github.com/lerna/lerna/tree/master/commands/publish#per-package-configuration" target="_blank" rel="noopener noreferrer">每个包的配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以了解发布作用域限定的包、自定义注册表和自定义标记的详细信息。</p> <h2 id="位置">位置</h2> <h3 id="from-git"><code>from-git</code></h3> <p>除了 <a href="https://github.com/lerna/lerna/tree/master/commands/version#positionals" target="_blank" rel="noopener noreferrer">lerna version<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 支持的语义化版本关键字外，<code>lerna publish</code>也支持<code>from-git</code>关键字。这将会识别<code>lerna version</code>标记的包，并将它们发布到 npm。这在您希望手动增加版本的 CI 场景中非常有用，但要通过自动化过程一直地发布包内容本身。</p> <h3 id="from-package"><code>from-package</code></h3> <p>与<code>from-git</code>关键字类似，只是要发布的包列表是通过检查每个<code>package.json</code>确定的，并且要确定注册表中是否存在任意版本的包。注册表中没有的任何版本都将被发布。当前一个<code>lerna publish</code>未能将所有包发布到注册表时，就是他发挥的时候了。</p> <h2 id="配置项">配置项</h2> <p><code>lerna publish</code>支持<code>lerna version</code>提供的所有配置项，除了以下这些：</p> <h3 id="canary"><code>--canary</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna publish --canary
<span class="token comment"># 1.0.0 =&gt; 1.0.1-alpha.0+${SHA} of packages changed since the previous commit</span>
<span class="token comment"># a subsequent canary publish will yield 1.0.1-alpha.1+${SHA}, etc</span>

lerna publish --canary --preid beta
<span class="token comment"># 1.0.0 =&gt; 1.0.1-beta.0+${SHA}</span>

<span class="token comment"># The following are equivalent:</span>
lerna publish --canary minor
lerna publish --canary preminor
<span class="token comment"># 1.0.0 =&gt; 1.1.0-alpha.0+${SHA}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>当使用该标志运行时，<code>lerna publish</code>以更粒度的方式(每次提交)来发布包。在发布到 npm 之前，它会通过当前的<code>version</code>创建新的<code>version</code>标记，升级到下一个小版本(minor)，添加传入的 meta 后缀(默认为<code>alpha</code>)并且附加当前的 git sha 码（例如：<code>1.0.0</code>变成<code>1.1.0-alpha.0+81e3b443</code>）。</p> <p>如果您已经从 CI 中的多个活动开发分支发布了 canary 版本，那么建议在每个分支的基础上定制<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--preid" target="_blank" rel="noopener noreferrer">--preid<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--dist-tag-tag" target="_blank" rel="noopener noreferrer">--dist-tag &lt;tag&gt;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以避免版本冲突。</p> <blockquote><p>该参数是需要发布每次提交版或每日构建版时使用。</p></blockquote> <h3 id="contents-dir"><code>--contents &lt;dir&gt;</code></h3> <p>要发布的子目录。必定应用于所有包，且必须包含 package.json 文件。包的生命周期仍然在原来的叶子目录中运行。您应当使用其中的一个生命周期(<code>prepare</code>、<code>prepublishOnly</code>或<code>prepack</code>)来创建子目录等等。</p> <p>如果您不喜欢非必要的复杂发布，这将给您带来乐趣。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna publish --contents dist
<span class="token comment"># 发布每个由 Lerna 管理的叶子包的 dist 文件夹</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">注意</p> <p>您应该等到<code>postpublish</code>生命周期阶段(根目录或叶目录)才清理这个生成的子目录，因为生成的 package.json 是在包上传期间(在<code>postpack</code>之后)使用的。</p></div> <h3 id="dist-tag-tag"><code>--dist-tag &lt;tag&gt;</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna publish --dist-tag next
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当带有该参数时，<code>lerna publish</code>将使用给定的 npm <a href="https://docs.npmjs.com/cli/dist-tag" target="_blank" rel="noopener noreferrer">dist-tag<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>(默认为<code>latest</code>) 发布到 npm。</p> <p>该配置项可用于在非<code>latest</code>的 dist-tag 下发布<a href="http://carrot.is/coding/npm_prerelease" target="_blank" rel="noopener noreferrer">预发布<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或<code>beta</code>版本，帮助用户免于自动升级到预发布质量的代码。</p> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p><code>latest</code>标记是用户运行<code>npm install my-package</code>时使用的标记。要安装不同的标记，用户可以运行<code>npm install my-package@prerelease</code>。</p></div> <h3 id="git-head-sha"><code>--git-head &lt;sha&gt;</code></h3> <p>在打包压缩时，显式地在 manifest 上设置为 gitHead，该操作只允许通过<a href="https://github.com/lerna/lerna/tree/master/commands/publish#bump-from-package" target="_blank" rel="noopener noreferrer">from-package<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>位置进行。</p> <p>举个例子，当我们从 AWS CodeBuild (这里<code>git</code>用不了)发布时，您可以使用该配置项传递适当的<a href="https://docs.aws.amazon.com/codebuild/latest/userguide/build-env-ref-env-vars.html" target="_blank" rel="noopener noreferrer">环境变量<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来作为该包的元数据。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>lerna publish <span class="token keyword">from</span><span class="token operator">-</span><span class="token keyword">package</span> <span class="token operator">--</span>git<span class="token operator">-</span>head $<span class="token punctuation">{</span><span class="token constant">CODEBUILD_RESOLVED_SOURCE_VERSION</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在所有其他情况下，该值是从本地的<code>git</code>命令派生而成的。</p> <h3 id="graph-type-all-dependencies"><code>--graph-type &lt;all|dependencies&gt;</code></h3> <p>设置在构建包依赖图时使用哪种依赖关系。默认值是<code>dependencies</code>，因此只包括包的<code>package.json</code>的<code>dependencies</code>部分中列出的包。若设置为<code>all</code>，则在构建包依赖图和决定拓扑顺序时会包括<code>dependencies</code>和<code>devDependencies</code>。</p> <p>在使用传统的 peer + dev 依赖对时，应该将此项配置为<code>all</code>，以便 peer 可以总在其依赖项之前发布。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>lerna publish --graph-type all
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过<code>lerna.json</code>来配置:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;publish&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;graphType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="ignore-scripts"><code>--ignore-scripts</code></h3> <p>这个参数会让<code>lerna publish</code>在发布期间禁用运行的<a href="https://github.com/lerna/lerna/tree/master/commands/publish#lifecycle-scripts" target="_blank" rel="noopener noreferrer">生命周期脚本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="ignore-prepublish"><code>--ignore-prepublish</code></h3> <p>这个参数会让<code>lerna publish</code>在发布期间禁用<a href="https://docs.npmjs.com/misc/scripts#prepublish-and-prepare" target="_blank" rel="noopener noreferrer">已废弃<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<a href="https://github.com/lerna/lerna/tree/master/commands/publish#lifecycle-scripts" target="_blank" rel="noopener noreferrer"><code>prepublish</code>脚本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="legacy-auth"><code>--legacy-auth</code></h3> <p>当您发布需要身份验证但使用内部托管的 NPM 注册表时，该注册表只使用旧 Base64 版本的 username:password。这与 NPM publish 的 <code>_auth</code>标志相同。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna publish --legacy-auth aGk6bW9t
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="no-git-reset"><code>--no-git-reset</code></h3> <p>默认情况下，<code>lerna publish</code>确保任何对工作树的更改都会被重置。</p> <p>为了避免这种情况，可以设置<code>——no-git-reset</code>。当作为 CI 流程的一部分与<code>——canary</code>一起使用时，这一点特别有用。例如，已经被替换的<code>package.json</code>版本号可能需要在随后的<code>CI</code>流程步骤中使用(比如 Docker 构建)。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna publish --no-git-reset
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="no-granular-pathspec"><code>--no-granular-pathspec</code></h3> <p>默认情况下，<code>lerna publish</code>将尝试(如果启用)只<code>git checkout</code>在发布过程中临时修改的叶子包清单。这相当于<code>git checkout -- packages/*/package.json</code>，但是<em>精确地</em>定制了变化。</p> <p>如果您确实知道您需要不同的行为，那么您就会理解：通过<code>--no-granular-pathspec</code>会让 git 命令执行的<code>git checkout -- .</code>。通过选择这个<a href="https://git-scm.com/docs/gitglossary#Documentation/gitglossary.txt-aiddefpathspecapathspec" target="_blank" rel="noopener noreferrer">路径规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，您必须有意忽略所有未版本化的内容。</p> <p>该项最好在<code>lerna.json</code>中配置，否则会原地去世的：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;independent&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;granularPathspec&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>根级配置是有意为之，因为它还包括了<a href="https://github.com/lerna/lerna/tree/master/commands/version#--no-granular-pathspec" target="_blank" rel="noopener noreferrer"><code>lerna version</code>中的同名配置项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="no-verify-access"><code>--no-verify-access</code></h3> <p>默认情况下，<code>lerna</code>将严重登录的 npm 用户对即将发布的包的访问权限。设置该参数将禁用该验证。</p> <p>如果您使用的是不支持<code>npm access ls-packages</code>的第三方注册表，则需要设置它(或在<code>lerna.json</code>中设置<code>command.publish.verifyAccess</code>为<code>false</code>)。</p> <div class="custom-block warning"><p class="custom-block-title">小心</p> <p>请小心使用。</p></div> <h3 id="otp"><code>--otp</code></h3> <p>当发布需要双重身份验证的包时，您可以使用<code>——otp</code>指定<a href="https://docs.npmjs.com/about-two-factor-authentication" target="_blank" rel="noopener noreferrer">一次性密码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna publish --otp <span class="token number">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">请注意</p> <p>一次性密码在生成后 <strong>30</strong> 秒内过期。如果它在发布操作期间到期，提示符将在继续之前请求更新后的值。</p></div> <h3 id="preid"><code>--preid</code></h3> <p>和同名的<code>lerna version</code>配置项不同，该配置项仅适用于 <a href="https://github.com/lerna/lerna/tree/master/commands/publish#--canary" target="_blank" rel="noopener noreferrer">--canary<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 版本计算。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna publish --canary
<span class="token comment"># 举例，使用下一个语义化预发布版本</span>
<span class="token comment"># 1.0.0 =&gt; 1.0.1-alpha.0</span>

lerna publish --canary --preid next
<span class="token comment"># 举例，使用指定的预发布标识符来标识下一个语义化预发布版本</span>
<span class="token comment"># 1.0.0 =&gt; 1.0.1-next.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>当使用该参数运行时，<code>lerna publish --canary</code>将使用指定的 <a href="http://semver.org/#spec-item-9" target="_blank" rel="noopener noreferrer">prerelease 标识符<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>递增<code>premajor</code>、<code>preminor</code>、<code>prepatch</code>或<code>prerelease</code>语义化版本。</p> <h3 id="pre-dist-tag-tag"><code>--pre-dist-tag &lt;tag&gt;</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna publish --pre-dist-tag next
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>除了只适用于与预发行版本一起发布的软件包外，它和<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--dist-tag-tag" target="_blank" rel="noopener noreferrer">--dist-tag<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>并无二致。</p> <h3 id="registry-url"><code>--registry &lt;url&gt;</code></h3> <p>当使用该参数运行时，转发的 npm 命令将为您的包使用指定 url 的注册表。</p> <p>如果您不想在使用私有注册表时在所有<code>package.json</code>文件中分别设置注册表配置，那就是它出场的时候。</p> <h3 id="tag-version-prefix"><code>--tag-version-prefix</code></h3> <p>配置项项允许提供自定义前缀来替代默认的<code>v</code>:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 本地</span>
lerna version --tag-version-prefix<span class="token operator">=</span><span class="token string">''</span>

<span class="token comment"># CI</span>
lerna publish from-git --tag-version-prefix<span class="token operator">=</span><span class="token string">''</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>您也可以在<code>lerna.json</code>中进行配置，对这两个命令也同样适用：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;tagVersionPrefix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;independent&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="temp-tag"><code>--temp-tag</code></h3> <p>当传递了该参数时，他将会改变默认的发布过程，首先将所有更改过的包发布到一个临时的 dist-tag (<code>lerna-temp</code>)中，然后将新版本移动到由<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--dist-tag-tag" target="_blank" rel="noopener noreferrer">--dist-tag<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>配置的 dist-tag 中(默认值<code>latest</code>)。</p> <p>这通常是没有必要的，因为Lerna在默认情况下会按照拓扑顺序(所有依赖项优先)来发布包。</p> <h3 id="yes"><code>--yes</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna publish --canary --yes
<span class="token comment"># 跳过“您确定要发布上述更改吗?”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当使用此标志运行时，<code>lerna publish</code>将跳过所有确认提示。在<a href="https://en.wikipedia.org/wiki/Continuous_integration" target="_blank" rel="noopener noreferrer">持续集成(CI)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中用于自动回答发布确认提示。</p> <h2 id="已废弃的配置项">已废弃的配置项</h2> <h3 id="skip-npm"><code>--skip-npm</code></h3> <p>直接调用 <a href="https://github.com/lerna/lerna/tree/master/commands/version#positionals" target="_blank" rel="noopener noreferrer">lerna version<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 即可。</p> <h2 id="每个包的配置">每个包的配置</h2> <p>叶子包可以可以配置特殊的<a href="https://docs.npmjs.com/files/package.json#publishconfig" target="_blank" rel="noopener noreferrer">publishConfig<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，在某些情况下可以改变<code>lerna publish</code>的行为。</p> <h3 id="publishconfig-access"><code>publishConfig.access</code></h3> <p>要发布具有作用域的包(如<code>@mycompany/rocks</code>)，您必须设置<a href="https://docs.npmjs.com/misc/config#access" target="_blank" rel="noopener noreferrer">access<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>如果把该字段设置到无作用域的包上，那么它会失败的。</li> <li>如果您希望限定范围的包保持私有状态(即<code>“restricted”</code>)，则无需设置该值。</li></ul> <p><strong>注意：这与在叶子包中设置<code>“private:true”</code>不一样。如果设置了<code>private</code>字段，那么在任何情况下都不会发布该包。</strong></p> <h3 id="publishconfig-registry"><code>publishConfig.registry</code></h3> <p>您可以通过设置<a href="https://docs.npmjs.com/misc/config#registry" target="_blank" rel="noopener noreferrer">registry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在每个包上定制注册表。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://my-awesome-registry.com/&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>传入<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--registry-url" target="_blank" rel="noopener noreferrer">--registry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以应用到全局，其实在某些情况下会起到反效果。</li></ul> <h3 id="publishconfig-tag"><code>publishConfig.tag</code></h3> <p>您可以通过设置<a href="https://docs.npmjs.com/misc/config#tag" target="_blank" rel="noopener noreferrer">tag<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来定制每个包的 dist-tag:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;flippin-sweet&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>传入<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--dist-tag-tag" target="_blank" rel="noopener noreferrer">--dist-tag<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>将会覆盖该值。</li> <li>如果同时传入了<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--canary" target="_blank" rel="noopener noreferrer">--canary<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>则该值会被忽略。</li></ul> <h3 id="publishconfig-directory"><code>publishConfig.directory</code></h3> <p>这个非标准字段允许您定制已发布的子目录，就像<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--contents-dir" target="_blank" rel="noopener noreferrer">--contents<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>一样，但它是以每个包为基础的。所有其他关于<code>--contents</code>的内容仍然适用。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;directory&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="生命周期脚本">生命周期脚本</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>// prepublish:      在打包和发布包之前运行。
// prepare:         在打包和发布包之前运行，在 prepublish 之后，prepublishOnly 之前。
// prepublishOnly:  在打包和发布包之前运行，只在 <span class="token function">npm</span> publish 时运行。
// prepack:         只在源码压缩打包之前运行。
// postpack:        在源码压缩打包生成并移动到最终目的地后运行。
// publish:         在包发布后运行。
// postpublish:     在包发布后运行。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Lerna 将在<code>lerna publish</code>期间运行<a href="https://docs.npmjs.com/misc/scripts#description" target="_blank" rel="noopener noreferrer">npm生命周期脚本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，顺序如下:</p> <ol><li>如果采用没有指定版本，则运行所有<a href="https://github.com/lerna/lerna/tree/master/commands/version#lifecycle-scripts" target="_blank" rel="noopener noreferrer">版本生命周期脚本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>如果<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--ignore-prepublish" target="_blank" rel="noopener noreferrer">可用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，在根目录运行<code>prepublish</code>生命周期。</li> <li>在根目录中运行<code>prepare</code>生命周期。</li> <li>在根目录中运行<code>prepublishOnly</code>生命周期。</li> <li>在根目录运行<code>prepack</code>生命周期。</li> <li>对于每个更改的包，按照拓扑顺序(所有依赖项在依赖关系之前):<br>
i. 如果<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--ignore-prepublish" target="_blank" rel="noopener noreferrer">可用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，运行<code>prepublish</code>生命周期。<br>
ii. 运行<code>prepare</code>生命周期。<br>
iii. 运行<code>prepublishOnly</code>生命周期。<br>
iv. 运行<code>prepack</code>生命周期。<br>
v. 通过<a href="https://github.com/lerna/lerna/tree/master/utils/pack-directory#readme" target="_blank" rel="noopener noreferrer">JS API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在临时目录中创建源码压缩包。
vi. 运行<code>postpack</code>生命周期。</li> <li>在根目录运行<code>postpack</code>生命周期。</li> <li>对于每个更改的包，按照拓扑顺序(所有依赖项在依赖关系之前):<br>
i. 通过<a href="https://github.com/lerna/lerna/tree/master/utils/npm-publish#readme" target="_blank" rel="noopener noreferrer">JS API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>发布包到配置的<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--registry-url" target="_blank" rel="noopener noreferrer">注册表<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。<br>
ii. 运行<code>publish</code>生命周期。<br>
iii. 运行<code>postpublish</code>生命周期。</li> <li>在根目录中运行<code>publish</code>生命周期。
<ul><li>为了避免递归调用，不要使用这个根生命周期来运行<code>lerna publish</code>。</li></ul></li> <li>在根目录中运行<code>postpublish</code>生命周期。</li> <li>如果<a href="https://github.com/lerna/lerna/tree/master/commands/publish#--temp-tag" target="_blank" rel="noopener noreferrer">可用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，将临时的 dist-tag 更新到最新</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lerna-docs-zh-cn/routes/commands/" class="prev router-link-active">
        指令总览
      </a></span> <span class="next"><a href="/lerna-docs-zh-cn/routes/commands/version.html">
        lerna/version
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lerna-docs-zh-cn/assets/js/app.49e1ae94.js" defer></script><script src="/lerna-docs-zh-cn/assets/js/2.c7b6054d.js" defer></script><script src="/lerna-docs-zh-cn/assets/js/29.b6e9c1cc.js" defer></script>
  </body>
</html>
