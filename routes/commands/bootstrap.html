<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lerna/bootstrap | Lerna</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/lerna-docs-zh-cn/images/lerna_favicon.ico">
    <meta name="description" content="用于管理带有多个包的 JavaScript 项目的工具。">
    <link rel="preload" href="/lerna-docs-zh-cn/assets/css/0.styles.6207e96a.css" as="style"><link rel="preload" href="/lerna-docs-zh-cn/assets/js/app.49e1ae94.js" as="script"><link rel="preload" href="/lerna-docs-zh-cn/assets/js/2.c7b6054d.js" as="script"><link rel="preload" href="/lerna-docs-zh-cn/assets/js/17.9563e499.js" as="script"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/10.b75cc033.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/11.779ba1c2.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/12.00a61c83.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/13.7471e1ef.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/14.d4e8f0b4.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/15.8ce0b658.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/16.54beaf8c.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/18.b02194ea.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/19.9bf827cd.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/20.d00780e6.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/21.0aca7fe9.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/22.7b433ac2.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/23.0304035d.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/24.1b83ab75.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/25.a92ecad3.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/26.cf0eee03.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/27.373f414c.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/28.356c1ef7.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/29.b6e9c1cc.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/3.46363123.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/30.9dfe906b.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/31.d82404dc.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/4.7351e2e0.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/5.392966c7.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/6.3569bd4e.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/7.01317e14.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/8.e54138c8.js"><link rel="prefetch" href="/lerna-docs-zh-cn/assets/js/9.70d8ce96.js">
    <link rel="stylesheet" href="/lerna-docs-zh-cn/assets/css/0.styles.6207e96a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lerna-docs-zh-cn/" class="home-link router-link-active"><img src="/lerna-docs-zh-cn/images/logo.png" alt="Lerna" class="logo"> <span class="site-name can-hide">Lerna</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.febeacon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大笑文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/" class="nav-link">
  文档首页
</a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/routes/commands/" class="nav-link router-link-active">
  Lerna 指令
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.febeacon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大笑文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/" class="nav-link">
  文档首页
</a></div><div class="nav-item"><a href="/lerna-docs-zh-cn/routes/commands/" class="nav-link router-link-active">
  Lerna 指令
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lerna-docs-zh-cn/routes/commands/" class="sidebar-link">指令总览</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/publish.html" class="sidebar-link">lerna/publish</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/version.html" class="sidebar-link">lerna/version</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html" class="active sidebar-link">lerna/bootstrap</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#使用" class="sidebar-link">使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#hoist-glob" class="sidebar-link">--hoist [glob]</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#strict" class="sidebar-link">--strict</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#nohoist-glob" class="sidebar-link">--nohoist [glob]</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#ignore" class="sidebar-link">--ignore</a></li></ul></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#配置项" class="sidebar-link">配置项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#ignore-prepublish" class="sidebar-link">--ignore-prepublish</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#ignore-scripts" class="sidebar-link">--ignore-scripts</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#registry-url" class="sidebar-link">--registry &lt;url&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#npm-client-client" class="sidebar-link">--npm-client &lt;client&gt;</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#use-workspaces" class="sidebar-link">--use-workspaces</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#no-ci" class="sidebar-link">--no-ci</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#force-local" class="sidebar-link">--force-local</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#publishconfig-directory" class="sidebar-link">publishConfig.directory</a></li></ul></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#它是怎么工作的？" class="sidebar-link">它是怎么工作的？</a></li><li class="sidebar-sub-header"><a href="/lerna-docs-zh-cn/routes/commands/bootstrap.html#注意" class="sidebar-link">注意</a></li></ul></li><li><a href="/lerna-docs-zh-cn/routes/commands/list.html" class="sidebar-link">lerna/list</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/changed.html" class="sidebar-link">lerna/changed</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/diff.html" class="sidebar-link">lerna/diff</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/exec.html" class="sidebar-link">lerna/exec</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/run.html" class="sidebar-link">lerna/run</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/init.html" class="sidebar-link">lerna/init</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/add.html" class="sidebar-link">lerna/add</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/clean.html" class="sidebar-link">lerna/clean</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/import.html" class="sidebar-link">lerna/import</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/link.html" class="sidebar-link">lerna/link</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/create.html" class="sidebar-link">lerna/create</a></li><li><a href="/lerna-docs-zh-cn/routes/commands/info.html" class="sidebar-link">lerna/info</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="lerna-bootstrap">@lerna/bootstrap</h1> <blockquote><p>将本地包链接在一起并安装剩余的包依赖项</p></blockquote> <p><a href="https://github.com/lerna/lerna/tree/master/commands/publish#readme" target="_blank" rel="noopener noreferrer">英文原地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>安装 lerna 以访问<code>lerna</code> CLI。</p> <h2 id="使用">使用</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>引导当前 Lerna 仓库中的包。安装器所有·依赖项并连接所有的交叉依赖。</p> <p>在运行时，该命令：</p> <ol><li><code>npm install</code>每个包所有的外部依赖。</li> <li>将所有相互依赖的 Lerna <code>package</code>符号链接在一起。</li> <li>在所有引导包中运行<code>npm run prepublish</code>(除非传入了<code>--ignore-prepublish</code>)。</li> <li>在所有引导包中运行<code>npm run prepare</code>。</li></ol> <p><code>lerna bootstrap</code>接受所有<a href="https://www.npmjs.com/package/@lerna/filter-options" target="_blank" rel="noopener noreferrer">过滤器属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>通过将额外的参数放在<code>--</code>之后来传递给 npm 客户端：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap -- --production --no-optional
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在<code>lerna.json</code>中这样配置：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;npmClientArgs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;--production&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--no-optional&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="hoist-glob">--hoist [glob]</h3> <p>在仓库根目录安装与<code>glob</code>匹配的外部依赖，这样所有包都可以使用他们。这些依赖的任何二进制文件都将链接到依赖包的<code>node_modules/.bin/</code>目录中，这样 npm 脚本就可以使用它们了。如果传了该参数但却没有设置<code>glob</code>，则默认为<code>**</code>(提升所有)。该配置项仅影响<code>bootstrap</code>命令。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap --hoist
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>关于<code>--hoist</code>，请参阅文档<a href="https://github.com/lerna/lerna/blob/master/doc/hoist.md" target="_blank" rel="noopener noreferrer">hoist documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>如果包依赖于不同版本的外部依赖项，则会将最常用的版本提升，并发出警告。</p></div> <p><code>--hoist</code>与<code>file：</code>标识符<a href="https://github.com/lerna/lerna/issues/1679#issuecomment-461544321" target="_blank" rel="noopener noreferrer">不兼容<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，请只使用一个。</p> <h3 id="strict">--strict</h3> <p>当和<code>hoist</code>一起使用时，会抛出一个错误，并在发出版本警告后停止引导。如果没有<code>hoist</code>或没有版本警告则无效果。</p> <h3 id="nohoist-glob">--nohoist [glob]</h3> <p><strong>不要</strong>在仓库根目录安装与<code>glob</code>匹配的外部依赖项。该参数可以用来选择不提升某些依赖项。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap --hoist --nohoist<span class="token operator">=</span>babel-*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="ignore">--ignore</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap --ignore component-*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>该参数与<code>bootstrap</code>命令一起使用时，也可以在<code>lerna.json</code>的<code>command.bootstrap.ignore</code>中设置。命令行中设置该参数优先于<code>lerna.json</code>。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bootstrap&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;ignore&quot;</span><span class="token operator">:</span> <span class="token string">&quot;component-*&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>通配符匹配的是<code>package.json</code>中定义的包名，而不是与包所在的目录名。</p></div> <h2 id="配置项">配置项</h2> <h3 id="ignore-prepublish"><code>--ignore-prepublish</code></h3> <p>跳过在引导包中默认运行的预发布生命周期脚本。注意，这个生命周期是<a href="https://docs.npmjs.com/misc/scripts#deprecation-note" target="_blank" rel="noopener noreferrer">已废弃的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可能会在Lerna 的下一个主要版本中被删除。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap --ignore-prepublish
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="ignore-scripts"><code>--ignore-scripts</code></h3> <p>跳过在引导包中正常运行的生命周期脚本(<code>prepare</code>等等)。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap --ignore-scripts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="registry-url"><code>--registry &lt;url&gt;</code></h3> <p>当使用该参数时，转发的 npm 命令将为您的包使用指定的注册表。</p> <p>如果您不想在使用私有注册表时在所有 package.json 文件中分别设置注册表配置，那么这就是它出场的时候了。</p> <h3 id="npm-client-client"><code>--npm-client &lt;client&gt;</code></h3> <p>它必须是一个知道如何安装 npm 包依赖的可执行文件。默认的<code>--npm-client</code>是<code>npm</code>。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap --npm-client<span class="token operator">=</span>yarn
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>也可在<code>lerna.json</code>中配置：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="use-workspaces"><code>--use-workspaces</code></h3> <p>支持和 <a href="https://github.com/yarnpkg/rfcs/blob/master/implemented/0000-workspaces-install-phase-1.md" target="_blank" rel="noopener noreferrer">yarn 工作区<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (从yarn@0.27+版本开始)数组中的值是 Lerna 将在其中委托操作给 Yarn 的命令(目前仅在 bootstrap 中可用)。如果<code>--use-workspaces</code>为真，那么<code>packages</code>将被<code>package.json/workspaces</code>的值覆盖。</p> <p>也可在<code>lerna.json</code>中配置：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;useWorkspaces&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>根级别的 package.json 还必须包含一个工作区数组:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;lerna&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.2.0&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这个列表与 lerna 的 <code>package</code>配置大体上类似(通过 package.json 用通配符匹配的目录列表)，只是它不支持递归的通配符匹配(<code>**</code>，也叫“globstars”)</p> <h3 id="no-ci"><code>--no-ci</code></h3> <p>当使用默认的<code>--npm-client</code>，<code>lerna bootstrap</code>将调用<a href="https://docs.npmjs.com/cli/ci" target="_blank" rel="noopener noreferrer">npm ci<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>而非在 CI 环境中调用<code>npm install</code>。若要禁用此行为，可以使用<code>--no-ci</code>:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap --no-ci
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>若要在本地安装期间强制执行(在本地安装中不会自动启用)，请使用<code>--ci</code>：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap --ci
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这对于“干净的”重新安装或重新克隆后的初次安装非常有用。</p> <h3 id="force-local"><code>--force-local</code></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap --force-local
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当使用该参数时，它会让<code>bootstrap</code>命令始终符号链接本地依赖项，而不考虑匹配的版本范围。</p> <h3 id="publishconfig-directory"><code>publishConfig.directory</code></h3> <p>这个<em>非标准</em>字段允许您自定义符号链接子目录，它会作为符号链接的源目录，就像使用已发布的包一样。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;directory&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在本例中，当这个包被引导并链接时，<code>dist</code>目录将是源目录(例如<code>package-1/dist =&gt; node_modules/package-1</code>)。</p> <h2 id="它是怎么工作的？">它是怎么工作的？</h2> <p>让我们以<code>babel</code>为例：</p> <ul><li><code>babel-generator</code>和<code>source-map</code>(以及其他)是<code>babel-core</code>的依赖项。</li> <li><code>babel-core</code>的<a href="https://github.com/babel/babel/blob/13c961d29d76ccd38b1fc61333a874072e9a8d6a/packages/babel-core/package.json#L28-L47" target="_blank" rel="noopener noreferrer">package.json<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>将这两个包作为<code>dependencies</code>中列出，如下所示。</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// babel-core package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel-core&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;babel-generator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.9.0&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;source-map&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.5.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>Lerna 会检查每个依赖项是否也是 Lerna 仓库的一部分。
<ul><li>在本例中，<code>babel-generator</code>可以是内部依赖项，而<code>source-map</code>始终是外部依赖项。</li> <li><code>babel-core</code>的<code>package.json</code>中的<code>babel-generator</code>版本通过<code>packages/babel-generator</code>来对应，传递内部依赖项。</li> <li><code>source-map</code>和正常一样使用<code>npm install</code>(或<code>yarn</code>)安装。</li></ul></li> <li><code>packages/babel-core/node_modules/babel-generator</code>符号链接到<code>packages/babel-generator</code></li> <li>允许目录嵌套引入。</li></ul> <h2 id="注意">注意</h2> <ul><li>当仓库中相同名称的包不能满足包中的依赖版本时，它将像往常一样以<code>npm install</code>或<code>yarn</code>的方式安装。</li> <li>类似<code>latest</code>的 Dist-tag，并不满足<a href="https://semver.npmjs.com/" target="_blank" rel="noopener noreferrer">语义化版本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>范围。</li> <li>循环依赖会导致循环符号链接，这可能会影响编辑器/IDE。</li></ul> <p><a href="https://www.jetbrains.com/webstorm/" target="_blank" rel="noopener noreferrer">WebStorm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>会在出现循环符号链接时锁定。为了防止这种情况，在<code>首选项(Preferences) =&gt; 编辑器(Editor) =&gt; 文件类型(File Types) =&gt; 忽略文件和文件夹(Ignored files and folders)</code>列表中添加<code>node_modules</code>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lerna-docs-zh-cn/routes/commands/version.html" class="prev">
        lerna/version
      </a></span> <span class="next"><a href="/lerna-docs-zh-cn/routes/commands/list.html">
        lerna/list
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lerna-docs-zh-cn/assets/js/app.49e1ae94.js" defer></script><script src="/lerna-docs-zh-cn/assets/js/2.c7b6054d.js" defer></script><script src="/lerna-docs-zh-cn/assets/js/17.9563e499.js" defer></script>
  </body>
</html>
